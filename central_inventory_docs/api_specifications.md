# Central Inventory - API Specifications

## API Design Principles

- **RESTful** architecture
- **JSON** request/response format
- **OAuth 2.0 + Azure AD** authentication
- **API versioning**: `/api/v1/`
- **Pagination**: Use `page` and `pageSize` query parameters
- **Filtering**: Use query parameters for filtering
- **Sorting**: Use `sortBy` and `sortOrder` query parameters

---

## Authentication & Authorization

### Headers

```http
Authorization: Bearer {azure_ad_token}
X-API-Version: 1.0
```

### RBAC Permissions

- **EndUser**: submit_transfer, view_own_transfers, escalate_own_transfer
- **Admin**: review_evidence, approve_reject, escalate_to_legal, upload_template
- **Legal**: review_escalated, approve_reject, deputize
- **Deputy-Legal/Deputy-Business**: same as Legal (scoped to assigned items)

---

## 1. User Management APIs

### 1.1 Get Current User
```http
GET /api/v1/users/me
```

**Response:**
```json
{
  "userId": "uuid",
  "email": "user@example.com",
  "fullName": "John Doe",
  "department": "IT",
  "roles": ["Admin", "EndUser"],
  "permissions": ["submit_transfer", "review_evidence"]
}
```

### 1.2 Get Users
```http
GET /api/v1/users?role=Legal&page=1&pageSize=20
```

**Query Parameters:**
- `role` (optional): Filter by role
- `department` (optional): Filter by department
- `search` (optional): Search by name or email

**Response:**
```json
{
  "data": [
    {
      "userId": "uuid",
      "email": "user@example.com",
      "fullName": "John Doe",
      "department": "IT",
      "roles": ["Admin"]
    }
  ],
  "pagination": {
    "page": 1,
    "pageSize": 20,
    "totalItems": 45,
    "totalPages": 3
  }
}
```

### 1.3 Assign Role
```http
POST /api/v1/users/{userId}/roles
```

**Request:**
```json
{
  "roleId": 2,
  "expiresAt": "2026-12-31T23:59:59Z" // optional
}
```

---

## 2. Controls & Templates APIs

### 2.1 Get Controls
```http
GET /api/v1/controls?type=MER&isActive=true
```

**Response:**
```json
{
  "data": [
    {
      "controlId": 1,
      "controlCode": "MER-13",
      "controlName": "MER-13: Data Classification",
      "controlType": "MER",
      "description": "...",
      "isActive": true
    }
  ]
}
```

### 2.2 Get Templates
```http
GET /api/v1/templates?controlId=1&status=ACTIVE
```

**Response:**
```json
{
  "data": [
    {
      "templateId": "uuid",
      "controlId": 1,
      "templateName": "MER-13 Template v2.0",
      "templateType": "DYNAMIC_FORM",
      "version": "2.0.0",
      "status": "ACTIVE",
      "sections": [...],
      "uploadedBy": "uuid",
      "uploadedAt": "2026-01-01T00:00:00Z",
      "usageCount": 42
    }
  ]
}
```

### 2.3 Upload Template
```http
POST /api/v1/templates
Content-Type: multipart/form-data
```

**Request:**
```http
controlId: 1
templateName: "MER-13 Form"
templateType: "DYNAMIC_FORM"
file: <binary>
autoGenerateStructure: true
```

**Response:**
```json
{
  "templateId": "uuid",
  "message": "Template uploaded successfully",
  "autoGeneratedSections": [...] // if autoGenerateStructure=true
}
```

### 2.4 Update Template
```http
PUT /api/v1/templates/{templateId}
```

**Request:**
```json
{
  "sections": [...],
  "status": "ACTIVE"
}
```

### 2.5 Delete Template
```http
DELETE /api/v1/templates/{templateId}
```

---

## 3. Transfers APIs

### 3.1 Create Transfer
```http
POST /api/v1/transfers
```

**Request:**
```json
{
  "transferName": "Data Transfer - App X",
  "controlId": 1,
  "templateId": "uuid", // optional (for MER)
  "jurisdiction": "US",
  "entity": "Entity Name",
  "subjectType": "Client",
  "merType": "MER-13", // optional
  "merTemplateData": {
    "fieldValues": {...},
    "tableData": {...},
    "fileData": {...}
  }
}
```

**Response:**
```json
{
  "transferId": "uuid",
  "message": "Transfer created successfully",
  "slaTracking": {
    "targetDate": "2026-01-26T00:00:00Z",
    "warningDate": "2026-01-24T00:00:00Z"
  }
}
```

### 3.2 Get Transfers
```http
GET /api/v1/transfers?status=ACTIVE&createdBy=me&page=1&pageSize=20
```

**Query Parameters:**
- `status`: Filter by status
- `createdBy`: `me` or user ID
- `jurisdiction`: Filter by jurisdiction
- `escalatedTo`: Filter escalated transfers
- `search`: Search by name

**Response:**
```json
{
  "data": [
    {
      "transferId": "uuid",
      "transferName": "...",
      "status": "ACTIVE",
      "jurisdiction": "US",
      "entity": "Entity",
      "merType": "MER-13",
      "createdBy": "uuid",
      "createdAt": "2026-01-12T00:00:00Z",
      "slaStatus": "ON_TRACK",
      "daysRemaining": 12,
      "requirementsSummary": {
        "total": 5,
        "approved": 2,
        "pending": 3
      }
    }
  ],
  "pagination": {...}
}
```

### 3.3 Get Transfer Details
```http
GET /api/v1/transfers/{transferId}
```

**Response:**
```json
{
  "transferId": "uuid",
  "transferName": "...",
  "status": "ACTIVE",
  "controlId": 1,
  "templateId": "uuid",
  "merType": "MER-13",
  "merTemplateData": {
    "fieldValues": {...},
    "tableData": {...},
    "fileData": {...}
  },
  "requirements": [...],
  "evidence": [...],
  "escalationInfo": {
    "escalatedTo": "Legal",
    "escalatedBy": "uuid",
    "reason": "...",
    "taggedAuthorities": ["EDPB"]
  },
  "slaTracking": {...},
  "createdBy": "uuid",
  "createdAt": "2026-01-12T00:00:00Z"
}
```

### 3.4 Update Transfer
```http
PUT /api/v1/transfers/{transferId}
```

**Request:**
```json
{
  "status": "COMPLETED", // Admin only
  "merTemplateData": {...} // End User before submission
}
```

### 3.5 Escalate Transfer
```http
POST /api/v1/transfers/{transferId}/escalate
```

**Request:**
```json
{
  "escalateTo": "Legal", // or "Business"
  "reason": "Cross-border sensitive data transfer",
  "taggedAuthorities": ["EDPB", "ICO"]
}
```

**Response:**
```json
{
  "message": "Transfer escalated to Legal",
  "notificationSent": true
}
```

---

## 4. Requirements APIs

### 4.1 Get Requirements for Transfer
```http
GET /api/v1/transfers/{transferId}/requirements
```

**Response:**
```json
{
  "data": [
    {
      "requirementId": "uuid",
      "requirementName": "...",
      "status": "APPROVED",
      "jurisdiction": "US",
      "dueDate": "2026-01-26T00:00:00Z"
    }
  ]
}
```

### 4.2 Update Requirement Status
```http
PUT /api/v1/requirements/{requirementId}
```

**Request:**
```json
{
  "status": "APPROVED"
}
```

---

## 5. Evidence APIs

### 5.1 Upload Evidence
```http
POST /api/v1/evidence
Content-Type: multipart/form-data
```

**Request:**
```http
transferId: uuid
requirementId: uuid (optional for MER)
description: "Architecture diagram"
file: <binary>
```

**Response:**
```json
{
  "evidenceId": "uuid",
  "fileName": "architecture.pdf",
  "fileSize": 1234567,
  "blobStorageUrl": "https://...",
  "uploadedAt": "2026-01-12T00:00:00Z"
}
```

### 5.2 Get Evidence for Transfer
```http
GET /api/v1/transfers/{transferId}/evidence
```

**Response:**
```json
{
  "data": [
    {
      "evidenceId": "uuid",
      "fileName": "file.pdf",
      "fileSize": 123456,
      "fileType": "PDF",
      "status": "APPROVED",
      "uploadedBy": "uuid",
      "uploadedAt": "2026-01-12T00:00:00Z",
      "reviewedBy": "uuid",
      "reviewedAt": "2026-01-13T00:00:00Z",
      "reviewerNote": "Approved"
    }
  ]
}
```

### 5.3 Get Evidence Queue (Admin/Legal)
```http
GET /api/v1/evidence/queue?status=PENDING&page=1&pageSize=20
```

**Query Parameters:**
- `status`: PENDING, UNDER_REVIEW, ESCALATED
- `escalatedTo`: Legal, Business
- `assignedDeputy`: user ID

**Response:**
```json
{
  "data": [
    {
      "evidenceId": "uuid",
      "transferId": "uuid",
      "transferName": "...",
      "fileName": "file.pdf",
      "status": "PENDING",
      "priority": "HIGH", // calculated based on SLA
      "uploadedAt": "2026-01-12T00:00:00Z",
      "slaStatus": "APPROACHING",
      "daysRemaining": 2
    }
  ],
  "pagination": {...}
}
```

### 5.4 Download Evidence
```http
GET /api/v1/evidence/{evidenceId}/download
```

**Response:**
- Binary file stream with appropriate Content-Type

### 5.5 Preview Evidence
```http
GET /api/v1/evidence/{evidenceId}/preview
```

**Response:**
- Rendered preview (for PDFs) or thumbnail

---

## 6. Workflow & Review APIs

### 6.1 Review Evidence
```http
POST /api/v1/evidence/{evidenceId}/review
```

**Request:**
```json
{
  "decision": "APPROVE", // APPROVE, REJECT, ESCALATE
  "note": "All documents are compliant",
  "escalateTo": "Legal", // required if decision = ESCALATE
  "escalationReason": "...", // required if decision = ESCALATE
  "taggedAuthorities": ["EDPB"] // optional
}
```

**Response:**
```json
{
  "message": "Evidence approved",
  "evidenceStatus": "APPROVED",
  "transferStatus": "COMPLETED", // if all requirements approved
  "notificationSent": true
}
```

### 6.2 Bulk Review Evidence
```http
POST /api/v1/evidence/bulk-review
```

**Request:**
```json
{
  "evidenceIds": ["uuid1", "uuid2"],
  "decision": "APPROVE",
  "note": "Bulk approval"
}
```

### 6.3 Review Transfer (MER)
```http
POST /api/v1/transfers/{transferId}/review
```

**Request:**
```json
{
  "overallDecision": "APPROVE", // APPROVE, REJECT, REQUEST_CHANGES
  "adminComments": "...",
  "attachmentDecisions": [
    {
      "attachmentId": "uuid",
      "attachmentType": "template", // template or evidence
      "decision": "APPROVE",
      "note": "Looks good"
    }
  ]
}
```

### 6.4 Deputize Transfer
```http
POST /api/v1/transfers/{transferId}/deputize
```

**Request:**
```json
{
  "deputyUserId": "uuid",
  "deputyType": "Deputy-Legal" // or "Deputy-Business"
}
```

### 6.5 Request Clarification
```http
POST /api/v1/transfers/{transferId}/request-clarification
```

**Request:**
```json
{
  "message": "Please provide more details about the data retention policy"
}
```

### 6.6 Respond to Clarification
```http
POST /api/v1/transfers/{transferId}/respond-clarification
```

**Request:**
```json
{
  "response": "Data is retained for 7 years as per policy XYZ"
}
```

---

## 7. SLA Tracking APIs

### 7.1 Get SLA Configurations
```http
GET /api/v1/sla/configurations
```

**Response:**
```json
{
  "data": [
    {
      "slaConfigId": 1,
      "controlId": 1,
      "controlCode": "MER-13",
      "targetResponseDays": 14,
      "warningThresholdDays": 3,
      "autoEscalateOnBreach": false
    }
  ]
}
```

### 7.2 Update SLA Configuration
```http
PUT /api/v1/sla/configurations/{slaConfigId}
```

**Request:**
```json
{
  "targetResponseDays": 10,
  "warningThresholdDays": 2,
  "autoEscalateOnBreach": true,
  "escalateToRole": "Legal"
}
```

### 7.3 Get SLA Breaches
```http
GET /api/v1/sla/breaches?status=BREACHED
```

**Response:**
```json
{
  "data": [
    {
      "transferId": "uuid",
      "transferName": "...",
      "slaStatus": "BREACHED",
      "targetDate": "2026-01-12T00:00:00Z",
      "daysOverdue": 3
    }
  ]
}
```

---

## 8. Notifications APIs

### 8.1 Get Notifications
```http
GET /api/v1/notifications?isRead=false&page=1&pageSize=20
```

**Response:**
```json
{
  "data": [
    {
      "notificationId": "uuid",
      "type": "submit_request",
      "message": "Your transfer #ABC has been submitted",
      "transferId": "uuid",
      "isRead": false,
      "createdAt": "2026-01-12T00:00:00Z"
    }
  ],
  "unreadCount": 5,
  "pagination": {...}
}
```

### 8.2 Mark Notification as Read
```http
PUT /api/v1/notifications/{notificationId}/read
```

### 8.3 Mark All as Read
```http
PUT /api/v1/notifications/mark-all-read
```

---

## 9. Audit Trail APIs

### 9.1 Get Audit Trail for Transfer
```http
GET /api/v1/transfers/{transferId}/audit-trail
```

**Response:**
```json
{
  "data": [
    {
      "auditId": "uuid",
      "action": "SUBMITTED",
      "previousStatus": null,
      "newStatus": "UNDER_REVIEW",
      "performedBy": "uuid",
      "performedByName": "John Doe",
      "performedAt": "2026-01-12T00:00:00Z",
      "notes": "Transfer submitted for review"
    }
  ]
}
```

### 9.2 Get Audit Trail for Evidence
```http
GET /api/v1/evidence/{evidenceId}/audit-trail
```

---

## 10. External Systems Integration APIs

### 10.1 Get Applications from SERA/iSAC/Cumulus
```http
GET /api/v1/external/applications?source=SERA&search=app
```

**Response:**
```json
{
  "data": [
    {
      "swcId": "SWC-12345",
      "swcName": "Application Name",
      "owner": "John Doe",
      "dataClassification": "Confidential",
      "locations": ["US", "EU"]
    }
  ]
}
```

### 10.2 Get Application Details
```http
GET /api/v1/external/applications/{swcId}
```

**Response:**
```json
{
  "swcId": "SWC-12345",
  "swcName": "Application Name",
  "owner": "John Doe",
  "dataClassification": "Confidential",
  "locations": ["US", "EU"],
  "hostingProvider": "AWS",
  "deploymentModel": "Cloud",
  "sourceSystem": "SERA",
  "lastSyncedAt": "2026-01-12T00:00:00Z"
}
```

### 10.3 Sync Applications
```http
POST /api/v1/external/sync
```

**Request:**
```json
{
  "source": "SERA", // or "iSAC", "Cumulus", "AppChk"
  "fullSync": false
}
```

---

## 11. Analytics & Reporting APIs

### 11.1 Get Dashboard Statistics
```http
GET /api/v1/analytics/dashboard?role=Admin
```

**Response:**
```json
{
  "totalTransfers": 156,
  "pendingReviews": 23,
  "approvedThisMonth": 45,
  "rejectedThisMonth": 3,
  "escalatedToLegal": 8,
  "slaBreaches": 2,
  "averageReviewTime": "3.5 days"
}
```

### 11.2 Get Compliance Report
```http
GET /api/v1/analytics/compliance-report?startDate=2026-01-01&endDate=2026-01-31
```

**Response:**
```json
{
  "reportId": "uuid",
  "period": "2026-01",
  "totalTransfers": 100,
  "byJurisdiction": {
    "US": 45,
    "EU": 35,
    "APAC": 20
  },
  "byStatus": {
    "COMPLETED": 80,
    "REJECTED": 5,
    "PENDING": 15
  },
  "slaCompliance": {
    "onTrack": 88,
    "breached": 2,
    "approaching": 10
  },
  "topReviewers": [...],
  "exportUrl": "https://..."
}
```

---

## 12. AI Integration APIs

### 12.1 AI Suggest Field Value
```http
POST /api/v1/ai/suggest-field
```

**Request:**
```json
{
  "fieldId": "dataClassification",
  "fieldType": "select",
  "context": {
    "swcId": "SWC-12345",
    "appName": "My App"
  }
}
```

**Response:**
```json
{
  "suggestedValue": "Confidential",
  "confidence": 0.92,
  "reasoning": "Application handles PII data"
}
```

### 12.2 AI Review Assistant
```http
POST /api/v1/ai/review-assist
```

**Request:**
```json
{
  "transferId": "uuid"
}
```

**Response:**
```json
{
  "riskScore": 0.85,
  "riskLevel": "HIGH",
  "riskFactors": ["Cross-border transfer", "Sensitive data"],
  "complianceIssues": ["Missing DPA"],
  "recommendation": "ESCALATE_TO_LEGAL",
  "suggestedComments": "This transfer requires legal review..."
}
```

### 12.3 AI Document Analysis
```http
POST /api/v1/ai/analyze-document
Content-Type: multipart/form-data
```

**Request:**
```http
file: <binary>
analysisType: "CONTRACT" // or "ARCHITECTURE", "DPA"
```

**Response:**
```json
{
  "documentType": "DPA",
  "extractedData": {
    "dataRetention": "7 years",
    "jurisdiction": "EU",
    "parties": ["Company A", "Company B"]
  },
  "missingClauses": ["Data breach notification timeline"],
  "riskFlags": ["Retention period exceeds business need"],
  "confidence": 0.88
}
```

---

## Error Handling

### Standard Error Response

```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid request parameters",
    "details": [
      {
        "field": "transferName",
        "message": "Transfer name is required"
      }
    ],
    "requestId": "req-uuid",
    "timestamp": "2026-01-12T00:00:00Z"
  }
}
```

### Error Codes

| Code | HTTP Status | Description |
|------|-------------|-------------|
| `UNAUTHORIZED` | 401 | Invalid or missing authentication |
| `FORBIDDEN` | 403 | Insufficient permissions |
| `NOT_FOUND` | 404 | Resource not found |
| `VALIDATION_ERROR` | 400 | Invalid request data |
| `CONFLICT` | 409 | Resource conflict (e.g., duplicate) |
| `INTERNAL_ERROR` | 500 | Server error |
| `SLA_BREACH` | 400 | Action not allowed due to SLA breach |

---

## Rate Limiting

```
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 995
X-RateLimit-Reset: 1736726400
```

- **Default**: 1000 requests per hour per user
- **Burst**: 100 requests per minute

---

## Webhooks (Optional Future Enhancement)

```http
POST /api/v1/webhooks/subscribe
```

**Request:**
```json
{
  "url": "https://your-app.com/webhook",
  "events": ["transfer.submitted", "evidence.approved", "sla.breach"],
  "secret": "webhook-secret"
}
```
